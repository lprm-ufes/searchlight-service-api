(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (process){
// Generated by CoffeeScript 1.9.2
(function() {
  var Ajax, CLIENT_SIDE, del, errors, get, getJSON, getJSONP, post, requestPromise;

  if (typeof process.browser === 'undefined') {
    requestPromise = require('request-promise');
    errors = require('request-promise/errors');
    requestPromise.defaults({
      jar: true
    });
    CLIENT_SIDE = false;
  } else {
    CLIENT_SIDE = true;
  }

  Ajax = (function() {
    function Ajax() {
      this.xhr = null;
      if (CLIENT_SIDE) {
        $.ajaxSetup({
          crossDomain: true,
          xhrFields: {
            withCredentials: true
          }
        });
      }
    }

    Ajax.prototype.get = function(params) {
      if (CLIENT_SIDE) {
        this.xhr = $.get(params);
      } else {
        this.xhr = requestPromise.get(params);
      }
      return this;
    };

    Ajax.prototype.post = function(params) {
      if (CLIENT_SIDE) {
        this.xhr = $.post(params);
      } else {
        this.xhr = requestPromise.post(params);
      }
      return this;
    };

    Ajax.prototype["delete"] = function(params) {
      if (CLIENT_SIDE) {
        params.type = "DELETE";
        params.crossDomains = true;
        this.xhr = $.ajax(params);
      } else {
        this.xhr = requestPromise.del(params);
      }
      return this;
    };

    Ajax.prototype.done = function(cb) {
      if (CLIENT_SIDE) {
        return this.xhr.done(cb);
      } else {
        return this.xhr.then(cb);
      }
    };

    Ajax.prototype.fail = function(cb) {
      if (CLIENT_SIDE) {
        return this.xhr.fail(cb);
      } else {
        return this.xhr["catch"](cb);
      }
    };

    return Ajax;

  })();

  get = function(params) {
    return new Ajax().get(params);
  };

  post = function(params) {
    return new Ajax().post(params);
  };

  del = function(params) {
    return new Ajax()["delete"](params);
  };

  getJSONP = function(url, func) {
    var xhr;
    xhr = get({
      'url': url,
      'type': "POST",
      'dataType': 'jsonp'
    });
    xhr.done(func);
    return xhr.fail(function(e, ee) {
      if (ee === "error") {
        return console.log('Erro ao baixar dados JSONP da fonte de dados\n' + url);
      }
    });
  };

  getJSON = function(url, func) {
    var xhr;
    xhr = get({
      'url': url,
      'dataType': "json",
      'contentType': 'application/json',
      'mimeType': "textPlain"
    });
    xhr.done(func);
    return xhr.fail(function() {
      return console.log('Erro ao baixar dados JSONP da fonte de dados\n' + url);
    });
  };

  if (CLIENT_SIDE) {
    window.getJSONP = getJSONP;
    window.getJSON = getJSON;
  }

  module.exports = {
    get: get,
    post: post,
    del: del,
    getJSON: getJSON,
    getJSONP: getJSONP,
    Ajax: Ajax
  };

}).call(this);

}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"request-promise":undefined,"request-promise/errors":undefined}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.9.2
(function() {
  var Config, ajax, events, utils;

  events = require('./events');

  utils = require('./utils');

  ajax = require('./ajax');

  Config = (function() {
    Config.debug = true;

    Config.EVENT_READY = 'config:ready.slsapi';

    Config.EVENT_FAIL = 'config:fail.slsapi';

    function Config(opcoes) {
      var self, xhr;
      this.id = utils.md5(JSON.stringify(opcoes));
      self = this;
      this.parseOpcoes(opcoes);
      if (opcoes.urlConfServico) {
        xhr = ajax.get(opcoes.urlConfServico);
        xhr.done(function(opcoes) {
          self.parseOpcoes(opcoes);
          return events.trigger(self.id, Config.EVENT_READY);
        });
        xhr.fail(function() {
          console.log('Error: não foi possível carregar configuração da visualização');
          return events.trigger(self.id, Config.EVENT_FAIL, 'Error: não foi possível carregar configuração da visualização');
        });
      }
    }

    Config.prototype.parseOpcoes = function(opcoes, view) {
      this.opcoes = new utils.Dicionario(opcoes);
      this.serverURL = this.opcoes.get('serverURL', 'http://sl.wancharle.com.br');
      this.createURL = this.opcoes.get('createURL', this.serverURL + "/note/create/");
      this.loginURL = this.opcoes.get('loginURL', this.serverURL + "/user/login/");
      this.logoutURL = this.opcoes.get('logoutURL', this.serverURL + "/user/logout/");
      this.notesURL = this.opcoes.get('notesURL', this.serverURL + "/note/");
      this.notebookURL = this.opcoes.get('notebookURL', this.serverURL + "/notebook/");
      this.dataSources = this.opcoes.get('dataSources', []);
      if (!view) {
        return this.coletorNotebookId = this.opcoes.get('id', '');
      }
    };

    return Config;

  })();

  module.exports = {
    'Config': Config
  };

}).call(this);

},{"./ajax":1,"./events":7,"./utils":12}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.9.2
(function() {
  var DataPool, DataSource, DataSourceCSV, DataSourceGoogle, createDataPool, createDataSource, events,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  events = require('./events');

  DataSource = require('./datasource').DataSource;

  DataSourceGoogle = require('./datasourceGoogle').DataSourceGoogle;

  DataSourceCSV = require('./datasourceCSV').DataSourceCSV;

  createDataSource = function(url, functionCode) {
    if (url.indexOf("docs.google.com/spreadsheet") > -1) {
      return new DataSourceGoogle(url, functionCode);
    } else {
      if (url.slice(-4) === ".csv") {
        return new DataSourceCSV(url, functionCode);
      } else {
        return new DataSource(url, functionCode);
      }
    }
  };

  createDataPool = function(config) {
    var instance;
    instance = DataPool.getInstance(config);
    if (instance) {
      instance.destroy();
    }
    instance = new DataPool();
    instance._constructor(config);
    return instance;
  };

  DataPool = (function() {
    function DataPool() {
      this.loadAllData = bind(this.loadAllData, this);
    }

    DataPool.EVENT_LOAD_START = 'datapool:start.slsapi';

    DataPool.EVENT_LOAD_STOP = 'datapool:stop.slsapi';

    DataPool.instances = {};

    DataPool.getInstance = function(config) {
      return this.instances[config.id];
    };

    DataPool.prototype._constructor = function(config) {
      var dataSources, index, j, len, s;
      DataPool.instances[config.id] = this;
      this.config = config;
      this.dataSources = [];
      dataSources = this.config.dataSources;
      for (index = j = 0, len = dataSources.length; j < len; index = ++j) {
        s = dataSources[index];
        this.addDataSource(s);
      }
      return events.on(config.id, DataSource.EVENT_LOADED, (function(_this) {
        return function() {
          return _this.onDataSourceLoaded();
        };
      })(this));
    };

    DataPool.prototype.addDataSource = function(s) {
      var source;
      source = createDataSource(s.url, s.func_code);
      if (source.isValid()) {
        return this.dataSources.push(source);
      }
    };

    DataPool.prototype.removeDataSource = function(i) {
      return this.dataSources.splice(i, 1);
    };

    DataPool.prototype.getDataSources = function() {
      return this.dataSources;
    };

    DataPool.prototype.updateFonte = function(url, func_code, index) {
      return this.dataSources[index] = createDataSource(url, func_code);
    };

    DataPool.prototype.getDataSource = function(i) {
      return this.dataSources[i];
    };

    DataPool.prototype.loadAllData = function() {
      var i, j, len, obj, ref, results, source;
      obj = this;
      this.sourcesLoaded = 0;
      events.trigger(this.config.id, DataPool.EVENT_LOAD_START);
      ref = this.dataSources;
      results = [];
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        source = ref[i];
        results.push(source.loadData(this.config, false));
      }
      return results;
    };

    DataPool.prototype.toJSON = function() {
      var array, f, i, j, len, ref;
      array = [];
      ref = this.dataSources;
      for (i = j = 0, len = ref.length; j < len; i = ++j) {
        f = ref[i];
        f.func_code = f.func_code.toString();
        array.push(f);
      }
      return array;
    };

    DataPool.prototype.onDataSourceLoaded = function() {
      this.sourcesLoaded += 1;
      if (this.sourcesLoaded === this.dataSources.length) {
        return events.trigger(this.config.id, DataPool.EVENT_LOAD_STOP, this);
      }
    };

    DataPool.prototype.destroy = function() {
      events.off(this.config.id, DataSource.EVENT_LOADED);
      events.off(this.config.id, DataPool.EVENT_LOAD_START);
      return events.off(this.config.id, DataPool.EVENT_LOAD_STOP);
    };

    return DataPool;

  })();

  module.exports = {
    DataPool: DataPool,
    createDataPool: createDataPool
  };

}).call(this);

},{"./datasource":4,"./datasourceCSV":5,"./datasourceGoogle":6,"./events":7}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.9.2
(function() {
  var DataSource, ajax, contexto, events, utils,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  events = require('./events');

  ajax = require('./ajax');

  utils = require('./utils');

  contexto = {};

  contexto = utils;

  DataSource = (function() {
    DataSource.EVENT_LOADED = 'datasourceLoaded.slsapi';

    DataSource.EVENT_LOAD_FAIL = 'datasourceLoadFail.slsapi';

    function DataSource(url, func_code) {
      this.addItem = bind(this.addItem, this);
      this._getCatOrCreate = bind(this._getCatOrCreate, this);
      var e;
      this.valid = true;
      if (url && typeof func_code === 'function') {
        this.url = url;
        this.func_code = func_code;
      } else {
        if (typeof func_code === 'string') {
          try {
            this.func_code = utils.string2function(func_code);
            this.url = url;
          } catch (_error) {
            e = _error;
            console.error(e, 'Error ao tentar criar funcao de conversao apartir de texto');
            this.valid = false;
          }
        } else {
          console.error("Error de configuração de fonte:", {
            url: url,
            func_code: func_code
          });
          this.valid = false;
        }
      }
      this.notes = [];
      this.notesChildren = {};
      this.categories = {};
      this.categories_id = {};
    }

    DataSource.prototype.isValid = function() {
      return this.valid;
    };

    DataSource.prototype._getCatOrCreate = function(i) {
      var cat;
      cat = this.categories[i.cat];
      if (cat) {
        return cat;
      } else {
        this.categories[i.cat] = [];
        this.categories_id[i.cat] = i.cat_id;
        return this.categories[i.cat];
      }
    };

    DataSource.prototype.addItem = function(i, func_convert) {
      var cat, e, geoItem;
      try {
        geoItem = func_convert(i, contexto);
      } catch (_error) {
        e = _error;
        console.error("Erro em DataSource::addItem: " + e.message, i);
        geoItem = null;
      }
      if (geoItem) {
        if (!geoItem.id) {
          geoItem.hashid = "" + (parseFloat(geoItem.latitude).toFixed(7)) + (parseFloat(geoItem.longitude).toFixed(7)) + (utils.md5(JSON.stringify(geoItem)));
        } else {
          if (!geoItem.hashid) {
            geoItem.hashid = geoItem.id;
          }
          geoItem.id = void 0;
        }
        this.notes.push(geoItem);
        if (geoItem.id_parent) {
          this.addChild(geoItem.id_parent, geoItem);
        }
        cat = this._getCatOrCreate(geoItem);
        cat.push(geoItem);
      }
      return geoItem;
    };

    DataSource.prototype.addChild = function(parentId, child) {
      if (!this.notesChildren[parentId]) {
        this.notesChildren[parentId] = [];
      }
      return this.notesChildren[parentId].push(child);
    };

    DataSource.prototype.loadData = function(config, force) {
      if (force == null) {
        force = false;
      }
      if (config.usarCache && config.noteid) {
        this.loadFromCache(config);
        return;
      }
      if (this.url.indexOf("docs.google.com/spreadsheet") > -1) {
        return this.loadFromGoogle(config);
      } else {
        if (this.url.slice(0, 4) === "http") {
          if (this.url.slice(-4) === ".csv") {
            return this.loadFromCsv(config);
          } else {
            return ajax.getJSONP(this.url, (function(_this) {
              return function(data) {
                return _this.onDataLoaded(data, _this, config);
              };
            })(this));
          }
        } else {
          return ajax.getJSON(this.url, (function(_this) {
            return function(data) {
              return _this.onDataLoaded(data, _this, config);
            };
          })(this));
        }
      }
    };

    DataSource.prototype.onDataLoaded = function(data, fonte, config) {
      var d, e, i, j, len;
      try {
        for (i = j = 0, len = data.length; j < len; i = ++j) {
          d = data[i];
          this.addItem(d, fonte.func_code);
        }
        return events.trigger(config.id, DataSource.EVENT_LOADED);
      } catch (_error) {
        e = _error;
        console.error(e.toString());
        events.trigger(config.id, DataSource.EVENT_LOAD_FAIL);
      }
    };

    DataSource.prototype.loadFromCache = function(config) {
      return ajax.getJSON(config.urlsls + "/note/listaExternal?noteid=" + config.noteid + "&fonteIndex=" + i, (function(_this) {
        return function(data) {
          var fonte2;
          fonte2 = {
            url: _this.url,
            func_code: function(i) {
              return i;
            }
          };
          return _this.onDataLoaded(data, fonte2);
        };
      })(this));
    };

    return DataSource;

  })();

  module.exports = {
    DataSource: DataSource
  };

}).call(this);

},{"./ajax":1,"./events":7,"./utils":12}],5:[function(require,module,exports){
(function (process){
// Generated by CoffeeScript 1.9.2
(function() {
  var CLIENT_SIDE, DataSource, DataSourceCSV, ajax, csvParse,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  if (typeof process.browser === 'undefined') {
    CLIENT_SIDE = false;
    csvParse = require('babyparse');
  } else {
    csvParse = Papa;
    CLIENT_SIDE = true;
  }

  DataSource = require('./datasource').DataSource;

  ajax = require('./ajax');

  DataSourceCSV = (function(superClass) {
    extend(DataSourceCSV, superClass);

    function DataSourceCSV() {
      return DataSourceCSV.__super__.constructor.apply(this, arguments);
    }

    DataSourceCSV.prototype.loadData = function(config) {
      var xhr;
      if (CLIENT_SIDE) {
        return csvParse.parse(this.url, {
          header: true,
          download: true,
          error: (function(_this) {
            return function() {
              return alert("Erro ao baixar arquivo csv da fonte de dados:\n" + _this.url);
            };
          })(this),
          complete: (function(_this) {
            return function(results, file) {
              console.log('teste');
              return _this.onDataLoaded(results['data'], _this, config);
            };
          })(this)
        });
      } else {
        xhr = ajax.get(this.url);
        xhr.done((function(_this) {
          return function(body) {
            var json, parsed;
            parsed = csvParse.parse(body, {
              header: true
            });
            json = parsed.data;
            return _this.onDataLoaded(json, _this, config);
          };
        })(this));
        return xhr.fail(function(error) {
          return console.log('error ao baixar CSV', error);
        });
      }
    };

    return DataSourceCSV;

  })(DataSource);

  module.exports = {
    DataSourceCSV: DataSourceCSV
  };

}).call(this);

}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"./ajax":1,"./datasource":4,"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"babyparse":undefined}],6:[function(require,module,exports){
(function (process){
// Generated by CoffeeScript 1.9.2
(function() {
  var CLIENT_SIDE, DataSource, DataSourceGoogle, TABLETOP,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  if (typeof process.browser === 'undefined') {
    CLIENT_SIDE = false;
    TABLETOP = require('tabletop');
  } else {
    TABLETOP = Tabletop;
    CLIENT_SIDE = true;
  }

  DataSource = require('./datasource').DataSource;

  DataSourceGoogle = (function(superClass) {
    extend(DataSourceGoogle, superClass);

    function DataSourceGoogle() {
      return DataSourceGoogle.__super__.constructor.apply(this, arguments);
    }

    DataSourceGoogle.prototype.loadData = function(config) {
      return TABLETOP.init({
        'key': this.url,
        'callback': (function(_this) {
          return function(data, tabletop) {
            return _this.onDataLoaded(data, _this, config);
          };
        })(this),
        'simpleSheet': true
      });
    };

    return DataSourceGoogle;

  })(DataSource);

  module.exports = {
    DataSourceGoogle: DataSourceGoogle
  };

}).call(this);

}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"./datasource":4,"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"tabletop":undefined}],7:[function(require,module,exports){
(function (process){
// Generated by CoffeeScript 1.9.2
(function() {
  var bind, emitter, emitters, events, select, trigger, unbind;

  emitter = null;

  if (typeof process.browser === 'undefined') {
    events = require('events');
    emitters = {};
    select = function(id) {
      if (!(id in emitters)) {
        emitters[id] = new events.EventEmitter();
      }
      return emitters[id];
    };
    trigger = function(id, event, param) {
      return select(id).emit(event, param);
    };
    bind = function(id, event, cb) {
      return select(id).once(event, cb);
    };
    unbind = function(id, event, cb) {};
  } else {
    select = function(id) {
      var target;
      target = $("#slEvent" + id);
      if (target.length <= 0) {
        target = $("<div id='slEvent" + id + "'> </div>");
        $("body").append(target);
      }
      return target;
    };
    trigger = function(id, event, param) {
      return select(id).trigger(event, param);
    };
    bind = function(id, event, cb) {
      var f;
      f = function(caller, params) {
        return cb(params);
      };
      return select(id).on(event, f);
    };
    unbind = function(id, event, cb) {
      return select(id).off(event);
    };
  }

  module.exports = {
    trigger: trigger,
    on: bind,
    off: unbind
  };

}).call(this);

}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"events":undefined}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.9.2
(function() {
  var Notebook, ajax;

  ajax = require('./ajax');

  Notebook = (function() {
    Notebook.instances = {};

    Notebook.getInstance = function(config) {
      return this.instances[config.id];
    };

    function Notebook(config) {
      Notebook.instances[config.id] = this;
      this.config = config;
    }

    Notebook.prototype.getByName = function(notebookName, callback, callbackFail) {
      var url, xhr;
      if (callbackFail == null) {
        callbackFail = null;
      }
      url = this.config.notebookURL + "?name=" + notebookName;
      xhr = ajax.get(url);
      return xhr.done(function(data) {
        return callback(data);
      });
    };

    Notebook.prototype.getById = function(notebookId, callback, callbackFail) {
      var url, xhr;
      if (callbackFail == null) {
        callbackFail = null;
      }
      url = this.config.notebookURL + "?id=" + notebookId;
      xhr = ajax.get(url);
      xhr.done(callback);
      return xhr.fail(callbackFail);
    };

    return Notebook;

  })();

  module.exports = {
    'Notebook': Notebook
  };

}).call(this);

},{"./ajax":1}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.9.2
(function() {
  var Notes, ajax, events;

  ajax = require('./ajax');

  events = require('./events');

  Notes = (function() {
    Notes.instances = {};

    Notes.getInstance = function(config) {
      return this.instances[config.id];
    };

    function Notes(config) {
      Notes.instances[config.id] = this;
      this.config = config;
    }

    Notes.prototype.getByUser = function(user_id, callback, callback_fail) {
      var xhr;
      xhr = ajax.get(this.config.notesURL + "?user=" + user_id);
      xhr.done(function(data) {
        return callback(data);
      });
      return xhr.fail(function() {
        return callback_fail();
      });
    };

    Notes.prototype.getByQuery = function(query, callback, callback_fail) {
      var xhr;
      xhr = ajax.get(this.config.notesURL + "?" + query);
      xhr.done(function(data) {
        return callback(data);
      });
      return xhr.fail(function() {
        return callback_fail();
      });
    };

    Notes.prototype.update = function(note_id, queryparams, callback, callback_fail) {
      var xhr;
      xhr = ajax.post(this.config.notesURL + "update/" + note_id + "/", queryparams);
      xhr.done(function(data) {
        return callback(data);
      });
      return xhr.fail(function() {
        return callback_fail();
      });
    };

    Notes.prototype["delete"] = function(note_id, callback) {
      var xhr;
      xhr = ajax.del({
        url: "" + this.config.notesURL + note_id
      });
      return xhr.done(function(data) {
        return callback(data);
      });
    };

    Notes.prototype.enviar = function(note, notebookId, callback_ok, callback_fail) {
      var ft, options, params;
      if (notebookId == null) {
        notebookId = null;
      }
      if (callback_ok == null) {
        callback_ok = (function() {});
      }
      if (callback_fail == null) {
        callback_fail = (function() {});
      }
      if (!notebookId) {
        if (!this.config.coletorNotebookId) {
          console.error('NotebookId não foi informado!');
          return;
        } else {
          notebookId = this.config.coletorNotebookId;
        }
      }
      params = note;
      params.notebook = notebookId;
      events.trigger(this.config.id, 'slsapi.note:uploadStart');
      if (note.fotoURI) {
        options = new FileUploadOptions();
        options.params = params;
        options.fileKey = "foto";
        options.fileName = note.fotoURI.substr(note.fotoURI.lastIndexOf('/') + 1);
        options.mimeType = "image/jpeg";
        options.params.fotoURL = true;
        ft = new FileTransfer();
        return ft.upload(note.fotoURI, encodeURI(this.config.createURL), (function(_this) {
          return function(r) {
            events.trigger(_this.config.id, 'slsapi.note:uploadFinish');
            return callback_ok(r);
          };
        })(this), (function(_this) {
          return function(error) {
            events.trigger(_this.config.id, 'slsapi.note:uploadFail');
            return callback_fail(error);
          };
        })(this), options);
      } else {
        return $.post(this.config.createURL, params, (function(_this) {
          return function(json) {
            events.trigger(_this.config.id, 'slsapi.note:uploadFinish');
            return callback_ok(json);
          };
        })(this), 'json').fail((function(_this) {
          return function(error) {
            events.trigger(_this.config.id, 'slsapi.note:uploadFail');
            return callback_fail(error);
          };
        })(this));
      }
    };

    return Notes;

  })();

  module.exports = {
    'Notes': Notes
  };

}).call(this);

},{"./ajax":1,"./events":7}],10:[function(require,module,exports){
(function (process){
// Generated by CoffeeScript 1.9.2
(function() {
  var Config, Notebook, SLSAPI, User, ajax, dataPool, events, notes;

  events = require('./events');

  ajax = require('./ajax');

  notes = require('./notes');

  Notebook = require('./notebook').Notebook;

  User = require('./user').User;

  Config = require('./config').Config;

  dataPool = require('./datapool');

  SLSAPI = (function() {
    function SLSAPI(opts) {
      this.config = new Config(opts);
      this.user = new User(this.config);
      this.notes = new notes.Notes(this.config);
      this.notebook = new Notebook(this.config);
    }

    SLSAPI.prototype.trigger = function(event, params) {
      return events.trigger(this.config.id, event, params);
    };

    SLSAPI.prototype.on = function(event, params) {
      return events.on(this.config.id, event, params);
    };

    SLSAPI.prototype.off = function(event, params) {
      return events.off(this.config.id, event, params);
    };

    return SLSAPI;

  })();

  SLSAPI.Config = Config;

  SLSAPI.Notes = notes.Notes;

  SLSAPI.dataPool = dataPool;

  SLSAPI.ajax = ajax;

  if (typeof process.browser !== 'undefined') {
    window.SLSAPI = SLSAPI;
  }

  module.exports = SLSAPI;

}).call(this);

}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"./ajax":1,"./config":2,"./datapool":3,"./events":7,"./notebook":8,"./notes":9,"./user":11,"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13}],11:[function(require,module,exports){
(function (process){
// Generated by CoffeeScript 1.9.2
(function() {
  var CLIENT_SIDE, LocalStorage, User, events, localStorage, md5,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  if (typeof process.browser === 'undefined') {
    md5 = require('blueimp-md5').md5;
    LocalStorage = require('node-localstorage').LocalStorage;
    localStorage = new LocalStorage('./scratch');
    CLIENT_SIDE = false;
  } else {
    CLIENT_SIDE = true;
    localStorage = window.localStorage;
    md5 = window.md5;
  }

  events = require('./events');

  User = (function() {
    User.instances = {};

    User.getInstance = function(config) {
      return this.instances[config.id];
    };

    function User(config1) {
      this.config = config1;
      this.login = bind(this.login, this);
      User.instances[this.config.id] = this;
      this.storage = localStorage;
      this.usuario = this.getUsuario();
    }

    User.prototype.isLogged = function() {
      var tempo_logado, usuario;
      usuario = this.getUsuario();
      if (usuario) {
        tempo_logado = ((new Date()).getTime() - this.logginTime) / 1000;
        if (tempo_logado > 24 * 3600) {
          return false;
        }
        return true;
      } else {
        return false;
      }
    };

    User.prototype.getUsuario = function() {
      this.usuario = this.storage.getItem('Usuario');
      this.user_id = this.storage.getItem('user_id');
      this.logginTime = this.storage.getItem('logginTime');
      return this.usuario;
    };

    User.prototype.setUsuario = function(usuario, json) {
      this.user_id = json.id;
      this.usuario = usuario;
      this.storage.setItem('Usuario', this.usuario);
      this.storage.setItem('user_id', this.user_id);
      return this.storage.setItem('logginTime', (new Date()).getTime());
    };

    User.prototype.logout = function(callback) {
      this.storage.removeItem('Usuario');
      this.usuario = null;
      this.user_id = null;
      return $.get(this.config.logoutURL, callback);
    };

    User.prototype.login = function(u, p) {
      var url;
      if (u && p) {
        url = this.config.loginURL;
        events.trigger(this.config.id, 'slsapi.user:loginStart');
        $.post(url, {
          username: u,
          password: p
        }, (function(_this) {
          return function(json) {
            if (json.error) {
              alert(json.error);
            } else {
              _this.setUsuario(u, json);
              events.trigger(_this.config.id, 'slsapi.user:loginSuccess');
            }
            return events.trigger(_this.config.id, 'slsapi.user:loginFinish');
          };
        })(this), "json").fail((function(_this) {
          return function() {
            return events.trigger(_this.config.id, 'slsapi.user:loginFail');
          };
        })(this));
      }
      return false;
    };

    return User;

  })();

  module.exports = {
    'User': User
  };

}).call(this);

}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"./events":7,"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"blueimp-md5":undefined,"node-localstorage":undefined}],12:[function(require,module,exports){
(function (process){
// Generated by CoffeeScript 1.9.2
(function() {
  var CLIENT_SIDE, Dicionario, dms2decPTBR, getURLParameter, md5, parseFloatPTBR, string2function,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  if (typeof process.browser === 'undefined') {
    md5 = require('blueimp-md5').md5;
    CLIENT_SIDE = false;
    dms2decPTBR = require('dms2dec-ptbr');
  } else {
    CLIENT_SIDE = true;
    md5 = window.md5;
    dms2decPTBR = window.dms2decPTBR;
  }

  Dicionario = (function() {
    function Dicionario(js_hash) {
      this.get = bind(this.get, this);
      if (typeof js_hash === 'string') {
        js_hash = JSON.parse(js_hash);
      }
      this.keys = Object.keys(js_hash);
      this.data = js_hash;
    }

    Dicionario.prototype.get = function(key, value) {
      if (indexOf.call(this.keys, key) >= 0) {
        return this.data[key];
      } else {
        return value;
      }
    };

    return Dicionario;

  })();

  getURLParameter = function(name) {
    return $(document).getUrlParam(name);
  };

  string2function = function(func_code) {
    var m, nome, re;
    re = /.*function *(\w*) *\( *([\w\,]*) *\) *\{/mg;
    if ((m = re.exec(func_code)) !== null) {
      if (m.index === re.lastIndex) {
        re.lastIndex++;
      }
      nome = m[1] || 'slsAnonymousFunction';
      if (CLIENT_SIDE) {
        return eval("window['" + nome + "']=" + func_code);
      } else {
        return eval("exports['" + nome + "']=" + func_code);
      }
    } else {
      return null;
    }
  };

  parseFloatPTBR = function(str) {
    var itens;
    itens = String(str).match(/^(-*\d+)([\,\.]*)(\d+)?$/);
    if (itens[2]) {
      return parseFloat(itens[1] + "." + itens[3]);
    } else {
      return parseFloat(itens[1]);
    }
  };

  if (CLIENT_SIDE) {
    window.parseFloatPTBR = parseFloatPTBR;
    window.string2function = string2function;
    window.getURLParameter = getURLParameter;
  }

  module.exports = {
    Dicionario: Dicionario,
    parseFloatPTBR: parseFloatPTBR,
    string2function: string2function,
    getURLParameter: getURLParameter,
    md5: md5,
    dms2decPTBR: dms2decPTBR
  };

}).call(this);

}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"blueimp-md5":undefined,"dms2dec-ptbr":undefined}],13:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = setTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            currentQueue[queueIndex].run();
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    clearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (!draining) {
        setTimeout(drainQueue, 0);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],14:[function(require,module,exports){
(function (process){
var Ajax, CLIENT_SIDE, del, errors, get, getJSON, getJSONP, post, requestPromise;

if (typeof process.browser === 'undefined') {
  requestPromise = require('request-promise');
  errors = require('request-promise/errors');
  requestPromise.defaults({
    jar: true
  });
  CLIENT_SIDE = false;
} else {
  CLIENT_SIDE = true;
}

Ajax = (function() {
  function Ajax() {
    this.xhr = null;
    if (CLIENT_SIDE) {
      $.ajaxSetup({
        crossDomain: true,
        xhrFields: {
          withCredentials: true
        }
      });
    }
  }

  Ajax.prototype.get = function(params) {
    if (CLIENT_SIDE) {
      this.xhr = $.get(params);
    } else {
      this.xhr = requestPromise.get(params);
    }
    return this;
  };

  Ajax.prototype.post = function(params) {
    if (CLIENT_SIDE) {
      this.xhr = $.post(params);
    } else {
      this.xhr = requestPromise.post(params);
    }
    return this;
  };

  Ajax.prototype["delete"] = function(params) {
    if (CLIENT_SIDE) {
      params.type = "DELETE";
      params.crossDomains = true;
      this.xhr = $.ajax(params);
    } else {
      this.xhr = requestPromise.del(params);
    }
    return this;
  };

  Ajax.prototype.done = function(cb) {
    if (CLIENT_SIDE) {
      return this.xhr.done(cb);
    } else {
      return this.xhr.then(cb);
    }
  };

  Ajax.prototype.fail = function(cb) {
    if (CLIENT_SIDE) {
      return this.xhr.fail(cb);
    } else {
      return this.xhr["catch"](cb);
    }
  };

  return Ajax;

})();

get = function(params) {
  return new Ajax().get(params);
};

post = function(params) {
  return new Ajax().post(params);
};

del = function(params) {
  return new Ajax()["delete"](params);
};

getJSONP = function(url, func) {
  var xhr;
  xhr = get({
    'url': url,
    'type': "POST",
    'dataType': 'jsonp'
  });
  xhr.done(func);
  return xhr.fail(function(e, ee) {
    if (ee === "error") {
      return console.log('Erro ao baixar dados JSONP da fonte de dados\n' + url);
    }
  });
};

getJSON = function(url, func) {
  var xhr;
  xhr = get({
    'url': url,
    'dataType': "json",
    'contentType': 'application/json',
    'mimeType': "textPlain"
  });
  xhr.done(func);
  return xhr.fail(function() {
    return console.log('Erro ao baixar dados JSONP da fonte de dados\n' + url);
  });
};

if (CLIENT_SIDE) {
  window.getJSONP = getJSONP;
  window.getJSON = getJSON;
}

module.exports = {
  get: get,
  post: post,
  del: del,
  getJSON: getJSON,
  getJSONP: getJSONP,
  Ajax: Ajax
};



}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"request-promise":undefined,"request-promise/errors":undefined}],15:[function(require,module,exports){
var Config, ajax, events, utils;

events = require('./events');

utils = require('./utils');

ajax = require('./ajax');

Config = (function() {
  Config.debug = true;

  Config.EVENT_READY = 'config:ready.slsapi';

  Config.EVENT_FAIL = 'config:fail.slsapi';

  function Config(opcoes) {
    var self, xhr;
    this.id = utils.md5(JSON.stringify(opcoes));
    self = this;
    this.parseOpcoes(opcoes);
    if (opcoes.urlConfServico) {
      xhr = ajax.get(opcoes.urlConfServico);
      xhr.done(function(opcoes) {
        self.parseOpcoes(opcoes);
        return events.trigger(self.id, Config.EVENT_READY);
      });
      xhr.fail(function() {
        console.log('Error: não foi possível carregar configuração da visualização');
        return events.trigger(self.id, Config.EVENT_FAIL, 'Error: não foi possível carregar configuração da visualização');
      });
    }
  }

  Config.prototype.parseOpcoes = function(opcoes, view) {
    this.opcoes = new utils.Dicionario(opcoes);
    this.serverURL = this.opcoes.get('serverURL', 'http://sl.wancharle.com.br');
    this.createURL = this.opcoes.get('createURL', this.serverURL + "/note/create/");
    this.loginURL = this.opcoes.get('loginURL', this.serverURL + "/user/login/");
    this.logoutURL = this.opcoes.get('logoutURL', this.serverURL + "/user/logout/");
    this.notesURL = this.opcoes.get('notesURL', this.serverURL + "/note/");
    this.notebookURL = this.opcoes.get('notebookURL', this.serverURL + "/notebook/");
    this.dataSources = this.opcoes.get('dataSources', []);
    if (!view) {
      return this.coletorNotebookId = this.opcoes.get('id', '');
    }
  };

  return Config;

})();

module.exports = {
  'Config': Config
};



},{"./ajax":14,"./events":20,"./utils":25}],16:[function(require,module,exports){
var DataPool, DataSource, DataSourceCSV, DataSourceGoogle, createDataPool, createDataSource, events,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

events = require('./events');

DataSource = require('./datasource').DataSource;

DataSourceGoogle = require('./datasourceGoogle').DataSourceGoogle;

DataSourceCSV = require('./datasourceCSV').DataSourceCSV;

createDataSource = function(url, functionCode) {
  if (url.indexOf("docs.google.com/spreadsheet") > -1) {
    return new DataSourceGoogle(url, functionCode);
  } else {
    if (url.slice(-4) === ".csv") {
      return new DataSourceCSV(url, functionCode);
    } else {
      return new DataSource(url, functionCode);
    }
  }
};

createDataPool = function(config) {
  var instance;
  instance = DataPool.getInstance(config);
  if (instance) {
    instance.destroy();
  }
  instance = new DataPool();
  instance._constructor(config);
  return instance;
};

DataPool = (function() {
  function DataPool() {
    this.loadAllData = bind(this.loadAllData, this);
  }

  DataPool.EVENT_LOAD_START = 'datapool:start.slsapi';

  DataPool.EVENT_LOAD_STOP = 'datapool:stop.slsapi';

  DataPool.instances = {};

  DataPool.getInstance = function(config) {
    return this.instances[config.id];
  };

  DataPool.prototype._constructor = function(config) {
    var dataSources, index, j, len, s;
    DataPool.instances[config.id] = this;
    this.config = config;
    this.dataSources = [];
    dataSources = this.config.dataSources;
    for (index = j = 0, len = dataSources.length; j < len; index = ++j) {
      s = dataSources[index];
      this.addDataSource(s);
    }
    return events.on(config.id, DataSource.EVENT_LOADED, (function(_this) {
      return function() {
        return _this.onDataSourceLoaded();
      };
    })(this));
  };

  DataPool.prototype.addDataSource = function(s) {
    var source;
    source = createDataSource(s.url, s.func_code);
    if (source.isValid()) {
      return this.dataSources.push(source);
    }
  };

  DataPool.prototype.removeDataSource = function(i) {
    return this.dataSources.splice(i, 1);
  };

  DataPool.prototype.getDataSources = function() {
    return this.dataSources;
  };

  DataPool.prototype.updateFonte = function(url, func_code, index) {
    return this.dataSources[index] = createDataSource(url, func_code);
  };

  DataPool.prototype.getDataSource = function(i) {
    return this.dataSources[i];
  };

  DataPool.prototype.loadAllData = function() {
    var i, j, len, obj, ref, results, source;
    obj = this;
    this.sourcesLoaded = 0;
    events.trigger(this.config.id, DataPool.EVENT_LOAD_START);
    ref = this.dataSources;
    results = [];
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      source = ref[i];
      results.push(source.loadData(this.config, false));
    }
    return results;
  };

  DataPool.prototype.toJSON = function() {
    var array, f, i, j, len, ref;
    array = [];
    ref = this.dataSources;
    for (i = j = 0, len = ref.length; j < len; i = ++j) {
      f = ref[i];
      f.func_code = f.func_code.toString();
      array.push(f);
    }
    return array;
  };

  DataPool.prototype.onDataSourceLoaded = function() {
    this.sourcesLoaded += 1;
    if (this.sourcesLoaded === this.dataSources.length) {
      return events.trigger(this.config.id, DataPool.EVENT_LOAD_STOP, this);
    }
  };

  DataPool.prototype.destroy = function() {
    events.off(this.config.id, DataSource.EVENT_LOADED);
    events.off(this.config.id, DataPool.EVENT_LOAD_START);
    return events.off(this.config.id, DataPool.EVENT_LOAD_STOP);
  };

  return DataPool;

})();

module.exports = {
  DataPool: DataPool,
  createDataPool: createDataPool
};



},{"./datasource":17,"./datasourceCSV":18,"./datasourceGoogle":19,"./events":20}],17:[function(require,module,exports){
var DataSource, ajax, contexto, events, utils,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

events = require('./events');

ajax = require('./ajax');

utils = require('./utils');

contexto = {};

contexto = utils;

DataSource = (function() {
  DataSource.EVENT_LOADED = 'datasourceLoaded.slsapi';

  DataSource.EVENT_LOAD_FAIL = 'datasourceLoadFail.slsapi';

  function DataSource(url, func_code) {
    this.addItem = bind(this.addItem, this);
    this._getCatOrCreate = bind(this._getCatOrCreate, this);
    var e;
    this.valid = true;
    if (url && typeof func_code === 'function') {
      this.url = url;
      this.func_code = func_code;
    } else {
      if (typeof func_code === 'string') {
        try {
          this.func_code = utils.string2function(func_code);
          this.url = url;
        } catch (_error) {
          e = _error;
          console.error(e, 'Error ao tentar criar funcao de conversao apartir de texto');
          this.valid = false;
        }
      } else {
        console.error("Error de configuração de fonte:", {
          url: url,
          func_code: func_code
        });
        this.valid = false;
      }
    }
    this.notes = [];
    this.notesChildren = {};
    this.categories = {};
    this.categories_id = {};
  }

  DataSource.prototype.isValid = function() {
    return this.valid;
  };

  DataSource.prototype._getCatOrCreate = function(i) {
    var cat;
    cat = this.categories[i.cat];
    if (cat) {
      return cat;
    } else {
      this.categories[i.cat] = [];
      this.categories_id[i.cat] = i.cat_id;
      return this.categories[i.cat];
    }
  };

  DataSource.prototype.addItem = function(i, func_convert) {
    var cat, e, geoItem;
    try {
      geoItem = func_convert(i, contexto);
    } catch (_error) {
      e = _error;
      console.error("Erro em DataSource::addItem: " + e.message, i);
      geoItem = null;
    }
    if (geoItem) {
      if (!geoItem.id) {
        geoItem.hashid = "" + (parseFloat(geoItem.latitude).toFixed(7)) + (parseFloat(geoItem.longitude).toFixed(7)) + (utils.md5(JSON.stringify(geoItem)));
      } else {
        if (!geoItem.hashid) {
          geoItem.hashid = geoItem.id;
        }
        geoItem.id = void 0;
      }
      this.notes.push(geoItem);
      if (geoItem.id_parent) {
        this.addChild(geoItem.id_parent, geoItem);
      }
      cat = this._getCatOrCreate(geoItem);
      cat.push(geoItem);
    }
    return geoItem;
  };

  DataSource.prototype.addChild = function(parentId, child) {
    if (!this.notesChildren[parentId]) {
      this.notesChildren[parentId] = [];
    }
    return this.notesChildren[parentId].push(child);
  };

  DataSource.prototype.loadData = function(config, force) {
    if (force == null) {
      force = false;
    }
    if (config.usarCache && config.noteid) {
      this.loadFromCache(config);
      return;
    }
    if (this.url.indexOf("docs.google.com/spreadsheet") > -1) {
      return this.loadFromGoogle(config);
    } else {
      if (this.url.slice(0, 4) === "http") {
        if (this.url.slice(-4) === ".csv") {
          return this.loadFromCsv(config);
        } else {
          return ajax.getJSONP(this.url, (function(_this) {
            return function(data) {
              return _this.onDataLoaded(data, _this, config);
            };
          })(this));
        }
      } else {
        return ajax.getJSON(this.url, (function(_this) {
          return function(data) {
            return _this.onDataLoaded(data, _this, config);
          };
        })(this));
      }
    }
  };

  DataSource.prototype.onDataLoaded = function(data, fonte, config) {
    var d, e, i, j, len;
    try {
      for (i = j = 0, len = data.length; j < len; i = ++j) {
        d = data[i];
        this.addItem(d, fonte.func_code);
      }
      return events.trigger(config.id, DataSource.EVENT_LOADED);
    } catch (_error) {
      e = _error;
      console.error(e.toString());
      events.trigger(config.id, DataSource.EVENT_LOAD_FAIL);
    }
  };

  DataSource.prototype.loadFromCache = function(config) {
    return ajax.getJSON(config.urlsls + "/note/listaExternal?noteid=" + config.noteid + "&fonteIndex=" + i, (function(_this) {
      return function(data) {
        var fonte2;
        fonte2 = {
          url: _this.url,
          func_code: function(i) {
            return i;
          }
        };
        return _this.onDataLoaded(data, fonte2);
      };
    })(this));
  };

  return DataSource;

})();

module.exports = {
  DataSource: DataSource
};



},{"./ajax":14,"./events":20,"./utils":25}],18:[function(require,module,exports){
(function (process){
var CLIENT_SIDE, DataSource, DataSourceCSV, ajax, csvParse,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

if (typeof process.browser === 'undefined') {
  CLIENT_SIDE = false;
  csvParse = require('babyparse');
} else {
  csvParse = Papa;
  CLIENT_SIDE = true;
}

DataSource = require('./datasource').DataSource;

ajax = require('./ajax');

DataSourceCSV = (function(superClass) {
  extend(DataSourceCSV, superClass);

  function DataSourceCSV() {
    return DataSourceCSV.__super__.constructor.apply(this, arguments);
  }

  DataSourceCSV.prototype.loadData = function(config) {
    var xhr;
    if (CLIENT_SIDE) {
      return csvParse.parse(this.url, {
        header: true,
        download: true,
        error: (function(_this) {
          return function() {
            return alert("Erro ao baixar arquivo csv da fonte de dados:\n" + _this.url);
          };
        })(this),
        complete: (function(_this) {
          return function(results, file) {
            console.log('teste');
            return _this.onDataLoaded(results['data'], _this, config);
          };
        })(this)
      });
    } else {
      xhr = ajax.get(this.url);
      xhr.done((function(_this) {
        return function(body) {
          var json, parsed;
          parsed = csvParse.parse(body, {
            header: true
          });
          json = parsed.data;
          return _this.onDataLoaded(json, _this, config);
        };
      })(this));
      return xhr.fail(function(error) {
        return console.log('error ao baixar CSV', error);
      });
    }
  };

  return DataSourceCSV;

})(DataSource);

module.exports = {
  DataSourceCSV: DataSourceCSV
};



}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"./ajax":14,"./datasource":17,"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"babyparse":undefined}],19:[function(require,module,exports){
(function (process){
var CLIENT_SIDE, DataSource, DataSourceGoogle, TABLETOP,
  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

if (typeof process.browser === 'undefined') {
  CLIENT_SIDE = false;
  TABLETOP = require('tabletop');
} else {
  TABLETOP = Tabletop;
  CLIENT_SIDE = true;
}

DataSource = require('./datasource').DataSource;

DataSourceGoogle = (function(superClass) {
  extend(DataSourceGoogle, superClass);

  function DataSourceGoogle() {
    return DataSourceGoogle.__super__.constructor.apply(this, arguments);
  }

  DataSourceGoogle.prototype.loadData = function(config) {
    return TABLETOP.init({
      'key': this.url,
      'callback': (function(_this) {
        return function(data, tabletop) {
          return _this.onDataLoaded(data, _this, config);
        };
      })(this),
      'simpleSheet': true
    });
  };

  return DataSourceGoogle;

})(DataSource);

module.exports = {
  DataSourceGoogle: DataSourceGoogle
};



}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"./datasource":17,"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"tabletop":undefined}],20:[function(require,module,exports){
(function (process){
var bind, emitter, emitters, events, select, trigger, unbind;

emitter = null;

if (typeof process.browser === 'undefined') {
  events = require('events');
  emitters = {};
  select = function(id) {
    if (!(id in emitters)) {
      emitters[id] = new events.EventEmitter();
    }
    return emitters[id];
  };
  trigger = function(id, event, param) {
    return select(id).emit(event, param);
  };
  bind = function(id, event, cb) {
    return select(id).once(event, cb);
  };
  unbind = function(id, event, cb) {};
} else {
  select = function(id) {
    var target;
    target = $("#slEvent" + id);
    if (target.length <= 0) {
      target = $("<div id='slEvent" + id + "'> </div>");
      $("body").append(target);
    }
    return target;
  };
  trigger = function(id, event, param) {
    return select(id).trigger(event, param);
  };
  bind = function(id, event, cb) {
    var f;
    f = function(caller, params) {
      return cb(params);
    };
    return select(id).on(event, f);
  };
  unbind = function(id, event, cb) {
    return select(id).off(event);
  };
}

module.exports = {
  trigger: trigger,
  on: bind,
  off: unbind
};



}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"events":undefined}],21:[function(require,module,exports){
var Notebook, ajax;

ajax = require('./ajax');

Notebook = (function() {
  Notebook.instances = {};

  Notebook.getInstance = function(config) {
    return this.instances[config.id];
  };

  function Notebook(config) {
    Notebook.instances[config.id] = this;
    this.config = config;
  }

  Notebook.prototype.getByName = function(notebookName, callback, callbackFail) {
    var url, xhr;
    if (callbackFail == null) {
      callbackFail = null;
    }
    url = this.config.notebookURL + "?name=" + notebookName;
    xhr = ajax.get(url);
    return xhr.done(function(data) {
      return callback(data);
    });
  };

  Notebook.prototype.getById = function(notebookId, callback, callbackFail) {
    var url, xhr;
    if (callbackFail == null) {
      callbackFail = null;
    }
    url = this.config.notebookURL + "?id=" + notebookId;
    xhr = ajax.get(url);
    xhr.done(callback);
    return xhr.fail(callbackFail);
  };

  return Notebook;

})();

module.exports = {
  'Notebook': Notebook
};



},{"./ajax":14}],22:[function(require,module,exports){
var Notes, ajax, events;

ajax = require('./ajax');

events = require('./events');

Notes = (function() {
  Notes.instances = {};

  Notes.getInstance = function(config) {
    return this.instances[config.id];
  };

  function Notes(config) {
    Notes.instances[config.id] = this;
    this.config = config;
  }

  Notes.prototype.getByUser = function(user_id, callback, callback_fail) {
    var xhr;
    xhr = ajax.get(this.config.notesURL + "?user=" + user_id);
    xhr.done(function(data) {
      return callback(data);
    });
    return xhr.fail(function() {
      return callback_fail();
    });
  };

  Notes.prototype.getByQuery = function(query, callback, callback_fail) {
    var xhr;
    xhr = ajax.get(this.config.notesURL + "?" + query);
    xhr.done(function(data) {
      return callback(data);
    });
    return xhr.fail(function() {
      return callback_fail();
    });
  };

  Notes.prototype.update = function(note_id, queryparams, callback, callback_fail) {
    var xhr;
    xhr = ajax.post(this.config.notesURL + "update/" + note_id + "/", queryparams);
    xhr.done(function(data) {
      return callback(data);
    });
    return xhr.fail(function() {
      return callback_fail();
    });
  };

  Notes.prototype["delete"] = function(note_id, callback) {
    var xhr;
    xhr = ajax.del({
      url: "" + this.config.notesURL + note_id
    });
    return xhr.done(function(data) {
      return callback(data);
    });
  };

  Notes.prototype.enviar = function(note, notebookId, callback_ok, callback_fail) {
    var ft, options, params;
    if (notebookId == null) {
      notebookId = null;
    }
    if (callback_ok == null) {
      callback_ok = (function() {});
    }
    if (callback_fail == null) {
      callback_fail = (function() {});
    }
    if (!notebookId) {
      if (!this.config.coletorNotebookId) {
        console.error('NotebookId não foi informado!');
        return;
      } else {
        notebookId = this.config.coletorNotebookId;
      }
    }
    params = note;
    params.notebook = notebookId;
    events.trigger(this.config.id, 'slsapi.note:uploadStart');
    if (note.fotoURI) {
      options = new FileUploadOptions();
      options.params = params;
      options.fileKey = "foto";
      options.fileName = note.fotoURI.substr(note.fotoURI.lastIndexOf('/') + 1);
      options.mimeType = "image/jpeg";
      options.params.fotoURL = true;
      ft = new FileTransfer();
      return ft.upload(note.fotoURI, encodeURI(this.config.createURL), (function(_this) {
        return function(r) {
          events.trigger(_this.config.id, 'slsapi.note:uploadFinish');
          return callback_ok(r);
        };
      })(this), (function(_this) {
        return function(error) {
          events.trigger(_this.config.id, 'slsapi.note:uploadFail');
          return callback_fail(error);
        };
      })(this), options);
    } else {
      return $.post(this.config.createURL, params, (function(_this) {
        return function(json) {
          events.trigger(_this.config.id, 'slsapi.note:uploadFinish');
          return callback_ok(json);
        };
      })(this), 'json').fail((function(_this) {
        return function(error) {
          events.trigger(_this.config.id, 'slsapi.note:uploadFail');
          return callback_fail(error);
        };
      })(this));
    }
  };

  return Notes;

})();

module.exports = {
  'Notes': Notes
};



},{"./ajax":14,"./events":20}],23:[function(require,module,exports){
(function (process){
var Config, Notebook, SLSAPI, User, ajax, dataPool, events, notes;

events = require('./events');

ajax = require('./ajax');

notes = require('./notes');

Notebook = require('./notebook').Notebook;

User = require('./user').User;

Config = require('./config').Config;

dataPool = require('./datapool');

SLSAPI = (function() {
  function SLSAPI(opts) {
    this.config = new Config(opts);
    this.user = new User(this.config);
    this.notes = new notes.Notes(this.config);
    this.notebook = new Notebook(this.config);
  }

  SLSAPI.prototype.trigger = function(event, params) {
    return events.trigger(this.config.id, event, params);
  };

  SLSAPI.prototype.on = function(event, params) {
    return events.on(this.config.id, event, params);
  };

  SLSAPI.prototype.off = function(event, params) {
    return events.off(this.config.id, event, params);
  };

  return SLSAPI;

})();

SLSAPI.Config = Config;

SLSAPI.Notes = notes.Notes;

SLSAPI.dataPool = dataPool;

SLSAPI.ajax = ajax;

if (typeof process.browser !== 'undefined') {
  window.SLSAPI = SLSAPI;
}

module.exports = SLSAPI;



}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"./ajax":14,"./config":15,"./datapool":16,"./events":20,"./notebook":21,"./notes":22,"./user":24,"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13}],24:[function(require,module,exports){
(function (process){
var CLIENT_SIDE, LocalStorage, User, events, localStorage, md5,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

if (typeof process.browser === 'undefined') {
  md5 = require('blueimp-md5').md5;
  LocalStorage = require('node-localstorage').LocalStorage;
  localStorage = new LocalStorage('./scratch');
  CLIENT_SIDE = false;
} else {
  CLIENT_SIDE = true;
  localStorage = window.localStorage;
  md5 = window.md5;
}

events = require('./events');

User = (function() {
  User.instances = {};

  User.getInstance = function(config) {
    return this.instances[config.id];
  };

  function User(config1) {
    this.config = config1;
    this.login = bind(this.login, this);
    User.instances[this.config.id] = this;
    this.storage = localStorage;
    this.usuario = this.getUsuario();
  }

  User.prototype.isLogged = function() {
    var tempo_logado, usuario;
    usuario = this.getUsuario();
    if (usuario) {
      tempo_logado = ((new Date()).getTime() - this.logginTime) / 1000;
      if (tempo_logado > 24 * 3600) {
        return false;
      }
      return true;
    } else {
      return false;
    }
  };

  User.prototype.getUsuario = function() {
    this.usuario = this.storage.getItem('Usuario');
    this.user_id = this.storage.getItem('user_id');
    this.logginTime = this.storage.getItem('logginTime');
    return this.usuario;
  };

  User.prototype.setUsuario = function(usuario, json) {
    this.user_id = json.id;
    this.usuario = usuario;
    this.storage.setItem('Usuario', this.usuario);
    this.storage.setItem('user_id', this.user_id);
    return this.storage.setItem('logginTime', (new Date()).getTime());
  };

  User.prototype.logout = function(callback) {
    this.storage.removeItem('Usuario');
    this.usuario = null;
    this.user_id = null;
    return $.get(this.config.logoutURL, callback);
  };

  User.prototype.login = function(u, p) {
    var url;
    if (u && p) {
      url = this.config.loginURL;
      events.trigger(this.config.id, 'slsapi.user:loginStart');
      $.post(url, {
        username: u,
        password: p
      }, (function(_this) {
        return function(json) {
          if (json.error) {
            alert(json.error);
          } else {
            _this.setUsuario(u, json);
            events.trigger(_this.config.id, 'slsapi.user:loginSuccess');
          }
          return events.trigger(_this.config.id, 'slsapi.user:loginFinish');
        };
      })(this), "json").fail((function(_this) {
        return function() {
          return events.trigger(_this.config.id, 'slsapi.user:loginFail');
        };
      })(this));
    }
    return false;
  };

  return User;

})();

module.exports = {
  'User': User
};



}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"./events":20,"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"blueimp-md5":undefined,"node-localstorage":undefined}],25:[function(require,module,exports){
(function (process){
var CLIENT_SIDE, Dicionario, dms2decPTBR, getURLParameter, md5, parseFloatPTBR, string2function,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

if (typeof process.browser === 'undefined') {
  md5 = require('blueimp-md5').md5;
  CLIENT_SIDE = false;
  dms2decPTBR = require('dms2dec-ptbr');
} else {
  CLIENT_SIDE = true;
  md5 = window.md5;
  dms2decPTBR = window.dms2decPTBR;
}

Dicionario = (function() {
  function Dicionario(js_hash) {
    this.get = bind(this.get, this);
    if (typeof js_hash === 'string') {
      js_hash = JSON.parse(js_hash);
    }
    this.keys = Object.keys(js_hash);
    this.data = js_hash;
  }

  Dicionario.prototype.get = function(key, value) {
    if (indexOf.call(this.keys, key) >= 0) {
      return this.data[key];
    } else {
      return value;
    }
  };

  return Dicionario;

})();

getURLParameter = function(name) {
  return $(document).getUrlParam(name);
};

string2function = function(func_code) {
  var m, nome, re;
  re = /.*function *(\w*) *\( *([\w\,]*) *\) *\{/mg;
  if ((m = re.exec(func_code)) !== null) {
    if (m.index === re.lastIndex) {
      re.lastIndex++;
    }
    nome = m[1] || 'slsAnonymousFunction';
    if (CLIENT_SIDE) {
      return eval("window['" + nome + "']=" + func_code);
    } else {
      return eval("exports['" + nome + "']=" + func_code);
    }
  } else {
    return null;
  }
};

parseFloatPTBR = function(str) {
  var itens;
  itens = String(str).match(/^(-*\d+)([\,\.]*)(\d+)?$/);
  if (itens[2]) {
    return parseFloat(itens[1] + "." + itens[3]);
  } else {
    return parseFloat(itens[1]);
  }
};

if (CLIENT_SIDE) {
  window.parseFloatPTBR = parseFloatPTBR;
  window.string2function = string2function;
  window.getURLParameter = getURLParameter;
}

module.exports = {
  Dicionario: Dicionario,
  parseFloatPTBR: parseFloatPTBR,
  string2function: string2function,
  getURLParameter: getURLParameter,
  md5: md5,
  dms2decPTBR: dms2decPTBR
};



}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13,"blueimp-md5":undefined,"dms2dec-ptbr":undefined}],26:[function(require,module,exports){
(function (process){
var SLSAPI, apid, teste, testeCSV, testeGoogle, testemain;

apid = 0;

if (typeof process.browser === 'undefined') {
  SLSAPI = require('../lib/slsapi');
} else {
  SLSAPI = require('../src/slsapi');
}

teste = function(texto, noteid, total, next) {
  var xhr;
  xhr = SLSAPI.ajax.get("http://sl.wancharle.com.br/note/" + noteid);
  xhr.done(function(data) {
    var dataPool;
    if (typeof process.browser === "undefined") {
      data = JSON.parse(data);
    }
    console.log(texto);
    data['config']['dataSources'] = data['config']['fontes'];
    apid.config.parseOpcoes(data['config'], true);
    dataPool = SLSAPI.dataPool.createDataPool(apid.config);
    dataPool.loadAllData();
    return apid.on(SLSAPI.dataPool.DataPool.EVENT_LOAD_STOP, function(datapool) {
      if (datapool.dataSources[0].notes.length === total) {
        console.log('OK --> [', total, 'itens ]');
        if (next) {
          return next();
        }
      } else {
        return console.error('fail', datapool.dataSources[0].notes.length, total);
      }
    });
  });
  return xhr.fail(function(error) {
    return console.log("error ao baixar config");
  });
};

testeGoogle = function() {
  return teste('Testando DataSourceGoogle', '553a69b8a7072f36708c03c7', 5, null);
};

testeCSV = function() {
  return teste('Testando DataSourceCSV', '554a9cc0d80060fa448d8b2f', 14472, function() {
    return testeGoogle();
  });
};

testemain = function() {
  console.log('Iniciando testes:');
  apid = new SLSAPI({
    urlConfServico: 'http://sl.wancharle.com.br/notebook/5514580391f57bdf0d0ba65b',
    nameSpace: 'teste'
  });
  return apid.on(SLSAPI.Config.EVENT_READY, function(a) {
    return testeCSV();
  });
};

if (typeof process.browser === 'undefined') {
  testemain();
} else {
  window.testemain = testemain;
}



}).call(this,require("/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"../lib/slsapi":10,"../src/slsapi":23,"/home/wancharle/searchlight-service-api/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":13}]},{},[26]);
